{% extends 'frontend/base.html' %}

{% block title %}Add file{% endblock %}

{% block sidebar %}
    <nav>
        <h2>Actions</h2>
        <ul class="nav nav-pills nav-stacked">
            <li role="presentation"><a href="{% url 'bdr.frontend:dataset-detail' slug=dataset.slug %}">
                <span class="glyphicon glyphicon-file" aria-hidden="true"></span> View
            </a></li>
            <li role="presentation"><a href="{% url 'bdr.frontend:dataset-edit' slug=dataset.slug %}">
                <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span> Edit
            </a></li>
            <li class="active" role="presentation"><a href="{% url 'bdr.frontend:file-add' slug=dataset.slug %}">
                <span class="glyphicon glyphicon-plus" aria-hidden="true"></span> Add file
            </a></li>
            <li role="presentation"><a href="{% url 'bdr.frontend:dataset-delete' slug=dataset.slug %}">
                <span class="glyphicon glyphicon-remove" aria-hidden="true"></span> Delete
            </a></li>
        </ul>
    </nav>
{% endblock %}

{% block content %}
    <header class="page-header">
        <h1>
            Edit new file
            <a class="small" href="{{ dataset.get_absolute_url }}">{{ dataset.name }}</a>
        </h1>
    </header>
    <section>
    <form class="form-horizontal" action="{% url 'bdr.frontend:file-add' slug=dataset.slug %}" method="post">
        {% csrf_token %}
        {{ wizard.management_form }}
        {{ wizard.form.management_form }}
        {% with errors=wizard.form.non_form_errors %}
        {% if errors %}
        <div class="panel panel-danger">
            <div class="panel-heading">Submission failed</div>
            <div class="panel-body">
                <ul class="errorlist">
                {% for error in errors %}
                    <li>{{ error }}</li>
                {% endfor %}
                </ul>
            </div>
        </div>
        {% endif %}
        {% endwith %}

        {% for form in wizard.form.forms %}
            <fieldset><legend>{{ form.name.value }}</legend>
            {% for field in form.hidden_fields %}
                {{ field }}
            {% endfor %}

            {% with form_errors=form.non_field_errors %}
            {% if form_errors %}
            <ul class="errorlist text-danger">
            {% for error in form_errors %}
                <li>{{ error }}</li>
            {% endfor %}
            </ul>
            {% endif %}
            {% endwith %}

            {% for field in form.visible_fields %}
                {% include 'frontend/fragments/field.html' %}
            {% endfor %}
            </fieldset>
        {% endfor %}

        <div class="form-group">
            <div class="form-inline col-xs-12 text-right">
                <input type="submit" class="btn btn-primary" value="Upload">
                <a class="btn btn-default" href="{% url 'bdr.frontend:dataset-detail' slug=dataset.slug %}">Cancel</a>
            </div>
        </div>
    </form>
    </section>
{% endblock %}
