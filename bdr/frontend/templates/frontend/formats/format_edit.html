{% extends "bdr/base.html" %}
{% load staticfiles %}

{% block title %}Editing {{ object.name }}{% endblock %}

{% block scripts %}
    <script type="text/javascript" src="{% static 'frontend/js/combo.js' %}"></script>
{% endblock %}

{% block sidebar %}
    <nav>
        <h2>Actions</h2>
        <ul class="nav nav-pills nav-stacked">
            <li role="presentation"><a href="{% url 'bdr.frontend:format-detail' slug=object.slug %}">
                <span class="glyphicon glyphicon-file" aria-hidden="true"></span> View
            </a></li>
            <li class="active" role="presentation"><a href="{% url 'bdr.frontend:format-edit' slug=object.slug %}">
                <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span> Edit
            </a></li>
            <li role="presentation"><a href="{% url 'bdr.frontend:format-delete' slug=object.slug %}">
                <span class="glyphicon glyphicon-remove" aria-hidden="true"></span> Delete
            </a></li>
        </ul>
    </nav>
{% endblock %}

{% block content %}
    <header class="page-header">
        <h1>{{ object.name }}</h1>
    </header>
    <section>
    <form class="form-horizontal" action="{% url 'bdr.frontend:format-edit' slug=object.slug %}" method="post">{% csrf_token %}
        <fieldset><legend>Details</legend>
        {% csrf_token %}
        {{ formset.management_form }}
        {% for field in form.hidden_fields %}
            {{ field }}
        {% endfor %}

        {% with form_errors=form.non_field_errors %}
        {% if form_errors %}
        <ul class="errorlist text-danger">
        {% for error in form_errors %}
            <li>{{ error }}</li>
        {% endfor %}
        </ul>
        {% endif %}
        {% endwith %}

        {% for field in form.visible_fields %}
            {% include 'frontend/fragments/field.html' %}
        {% endfor %}
        </fieldset>

        <fieldset><legend>Fields</legend>
        <table class="table table-responsive table-condensed">
        <thead>
            <tr>
                <th colspan="2">Name</th>
                <th>Key</th>
                <th>Delete?</th>
            </tr>
        </thead>
        <tbody>
        {% for form in formset %}
            <tr>
                <td>{{ form.name }}</td>
                <td>
                {% for field in form.hidden_fields %}
                    {{ field }}
                {% endfor %}
                </td>
                <td style="vertical-align: middle">{{ form.is_key }}</td>
                <td style="vertical-align: middle">{{ form.DELETE }}</td>
            </tr>
        {% endfor %}
        </tbody>
        </table>
        </fieldset>

        <div class="form-group">
            <div class="form-inline col-xs-12 text-right">
                <input type="submit" class="btn btn-primary" value="Save">
                <button name="operation" type="submit" class="btn btn-primary" value="add">
                    <span class="glyphicon glyphicon-plus"></span> Add field</button>
                <a class="btn btn-default" href="{% url 'bdr.frontend:format-detail' slug=form.initial.slug %}">Cancel</a>
            </div>
        </div>
    </form>
    </section>
{% endblock %}
