{% extends "bdr/base.html" %}

{% block title %}{{ object.name }}{% endblock %}

{% block sidebar %}
    <nav>
        <h2>Actions</h2>
        <ul class="nav nav-pills nav-stacked">
            <li class="active" role="presentation"><a href="{{ object.get_absolute_url }}">
                <span class="glyphicon glyphicon-file" aria-hidden="true"></span> View
            </a></li>
            <li role="presentation"><a href="{% url 'bdr.frontend:dataset-edit' slug=object.slug %}">
                <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span> Edit
            </a></li>
            <li role="presentation"><a href="{% url 'bdr.frontend:file-add' slug=object.slug %}">
                <span class="glyphicon glyphicon-plus" aria-hidden="true"></span> Add file
            </a></li>
            <li role="presentation"><a href="{% url 'bdr.frontend:dataset-delete' slug=object.slug %}">
                <span class="glyphicon glyphicon-remove" aria-hidden="true"></span> Delete
            </a></li>
        </ul>
    </nav>
{% endblock %}

{% block content %}
    <header class="page-header">
        <h1>
            {{ object.name }}
            {% for tag in object.tags.all %}
                <a class="label label-default tag"
                   href="{% url 'bdr.frontend:search' %}?query={{ tag|urlencode }}">{{ tag }}</a>
            {% endfor %}
        </h1>
        {% with breadcrumb='frontend/fragments/category_breadcrumb.html' categories=object.categories.all %}
        {% if categories %}
        <nav>
            {% for category in categories %}
            <ol class="breadcrumb">
                {% include breadcrumb with category=category breadcrumb=breadcrumb only %}
            </ol>
            {% endfor %}
        </nav>
        {% endif %}
        {% endwith %}
    </header>
    <section>
        <h2>Details</h2>
        <div class="panel panel-default">
            <div class="panel-heading" data-toggle="collapse" data-target="#notes" aria-controls="notes"
                 aria-expanded="{% if object.notes %}true{% else %}false{% endif %}">Notes <span class="caret"></span></div>
            <div class="panel-body collapse{% if object.notes %} in{% endif %}" id="notes">
            {{ object.notes|urlize|linebreaks|default:'None' }}
            </div>
        </div>

        <div class="panel panel-default">
            <div class="panel-heading" data-toggle="collapse" data-target="#source" aria-controls="source"
                 aria-expanded="{% if object.update_uri %}true{% else %}false{% endif %}">Source <span
                    class="caret"></span></div>
            <div class="panel-body container-fluid form-horizontal collapse{% if object.update_uri %} in{% endif %}"
                 id="source">
                <div class="form-group row">
                    <label class="control-label col-sm-3">Address:</label>
                    <div class="col-sm-9">
                        <p class="form-control-static">{{ object.update_uri|default:'None' }}</p>
                    </div>
                </div>
                {% if object.update_uri %}
                <div class="form-group row">
                    <label class="control-label col-sm-3">User:</label>
                    <div class="col-sm-9">
                        <p class="form-control-static">{{ object.update_username|default:'None' }}</p>
                    </div>
                </div>
                <div class="form-group row">
                    <label class="control-label col-sm-3">Update frequency:</label>
                    <div class="col-sm-9">
                        <p class="form-control-static">
                            {% if object.update_frequency %}{{ object.update_frequency }} minutes{% else %}
                                Disabled{% endif %}</p>
                    </div>
                </div>
                {% endif %}
            </div>
        </div>


        <h2>Files</h2>
        {% with files=object_list %}
        {% if files %}
            <table class="table table-condensed">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Revisions</th>
                        <td></td>
                    </tr>
                </thead>
            {% for file in files %}
                <tbody>
                <tr>
                    <th>
                        <a href="{{ file.get_absolute_url }}">{{ file.name }}</a>
                    {% if file.num_revisions > 0 %}
                        <a class="btn btn-link btn-xs" href="{% url 'bdr.frontend:download' ds=object.slug fn=file.name rev='latest' %}"
                           title="Download latest revision">
                            <span class="glyphicon glyphicon-download" aria-hidden="true"></span>
                        </a>
                    {% endif %}
                    </th>
                    <td>{{ file.num_revisions }}</td>
                    <td class="text-right">
                {% if file.tags.all|length > 0 %}
                    {% for tag in file.tags.all %}
                        <a class="small label label-default"
                           href="{% url 'bdr.frontend:search' %}"?query={{ tag|urlencode }}>{{ tag }}</a>
                    {% endfor %}
                {% endif %}
                    </td>
                </tr>
                </tbody>
            {% endfor %}
            </table>

            {% include 'frontend/fragments/pagination.html' with url=object.get_absolute_url %}
        {% else %}
            <p class="alert alert-warning">There are no files in this dataset.</p>
        {% endif %}
        {% endwith %}
    </section>
{% endblock %}
