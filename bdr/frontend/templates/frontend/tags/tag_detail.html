{% extends 'frontend/base.html' %}
{% load humanize %}

{% block title %}#{{ object.name }}{% endblock %}

{% block sidebar %}
    <nav>
        <h2>Actions</h2>
        <ul class="nav nav-pills nav-stacked">
            <li class="active" role="presentation"><a href="{% url 'bdr.frontend:tag-detail' name=object.name %}">
                <span class="glyphicon glyphicon-file" aria-hidden="true"></span> View
            </a></li>
            <li role="presentation"><a href="{% url 'bdr.frontend:tag-edit' name=object.name %}">
                <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span> Edit
            </a></li>
            <li role="presentation"><a href="{% url 'bdr.frontend:tag-delete' name=object.name %}">
                <span class="glyphicon glyphicon-remove" aria-hidden="true"></span> Delete
            </a></li>
        </ul>
    </nav>
{% endblock %}

{% block content %}
    <header class="page-header">
        <h1>#{{ object.name }}</h1>
    </header>
    <section>
        <h2>Datasets</h2>
        {% if datasets %}
        <table class="table table-responsive table-condensed">
            <thead>
                <tr>
                    <th>Dataset</th>
                    <th>Files</th>
                    <th>Updated</th>
                </tr>
            </thead>
            <tbody>
            {% for dataset in datasets %}
                <tr>
                    <td><a href="{{ dataset.get_absolute_url }}">{{ dataset.name }}</a></td>
                    <td>{{ dataset.num_files }}</td>
                    <td>{{ dataset.latest_revision|naturaltime }}</td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
        {% else %}
        <p>No datasets have this tag.</p>
        {% endif %}

        <h2>Files</h2>
        {% if files %}
        <table class="table table-responsive table-condensed">
        <thead>
            <tr>
                <th>Dataset</th>
                <th>File</th>
                <th>Revisions</th>
                <th>Updated</th>
            </tr>
        </thead>
        <tbody>
        {% for file in files %}
            <tr>
                <td><a href="{{ file.dataset.get_absolute_url }}">{{ file.dataset.name }}</a></td>
                <td><a href="{{ file.get_absolute_url }}">{{ file.name }}</a></td>
                <td>{{ file.revisions.count }}</td>
                <td>{{ file.revisions.first.updated_at|naturaltime }}</td>
            </tr>
        {% endfor %}
        </tbody>
        </table>
        {% else %}
        <p>No files have this tag.</p>
        {% endif %}

        <h2>Revisions</h2>
        {% if revisions %}
        <table class="table table-responsive table-condensed">
        <thead>
            <tr>
                <th>Dataset</th>
                <th>File</th>
                <th>Revision</th>
                <th>Updated</th>
                <th>Size</th>
            </tr>
        </thead>
        <tbody>
        {% for revision in revisions %}
            <tr>
                <td>
                    <a href="{{ revision.file.dataset.get_absolute_url }}">{{ revision.file.dataset.name }}</a>
                </td>
                <td><a href="{{ revision.file.get_absolute_url }}">{{ revision.file.name }}</a></td>
                <td>{{ revision.level }}</td>
                <td title="Updated on {{ revision.updated_at }}">{{ revision.updated_at|naturaltime }}</td>
                <td>
                    {{ revision.size|filesizeformat }}
                    <a class="btn btn-link btn-xs" href="{{ revision.get_absolute_url }}"
                       title="Download revision">
                        <span class="glyphicon glyphicon-download" aria-hidden="true"></span>
                    </a>
                </td>
            </tr>
        {% endfor %}
        </tbody>
        </table>
        {% else %}
        <p>No revisions have this tag.</p>
        {% endif %}
    </section>
{% endblock %}
